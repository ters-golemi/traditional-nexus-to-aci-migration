! Nexus Access Switch 1 Configuration
! Device: Nexus 9000 Series
! Role: Access Layer Server Connectivity
! vPC Peer: access-02

version 9.3(10)
hostname access-01

! Management
username admin password 5 $5$CHANGE_ME role network-admin
ip domain-lookup

! vPC Configuration
feature vpc
vpc domain 300
  peer-switch
  peer-keepalive destination 192.168.100.6 source 192.168.100.5
  peer-gateway
  auto-recovery

! Features
feature lacp

! VLANs
vlan 10
  name WEB_TIER
vlan 20
  name APP_TIER
vlan 30
  name DB_TIER
vlan 40
  name MGMT
vlan 50
  name DMZ
vlan 100
  name INFRASTRUCTURE
vlan 110-119
  name APPLICATION_VLANS
vlan 200
  name STORAGE

! Uplink to Aggregation Layer
interface Ethernet1/1
  description To AGG-01 Eth1/10
  switchport mode trunk
  switchport trunk allowed vlan 10,20,30,40,50,100,110-119,200
  channel-group 1 mode active

interface Ethernet1/2
  description To AGG-01 Eth1/11
  switchport mode trunk
  switchport trunk allowed vlan 10,20,30,40,50,100,110-119,200
  channel-group 1 mode active

interface Ethernet1/3
  description To AGG-02 Eth1/12
  switchport mode trunk
  switchport trunk allowed vlan 10,20,30,40,50,100,110-119,200
  channel-group 2 mode active

interface Ethernet1/4
  description To AGG-02 Eth1/13
  switchport mode trunk
  switchport trunk allowed vlan 10,20,30,40,50,100,110-119,200
  channel-group 2 mode active

! Port-Channels to Aggregation
interface port-channel1
  description To AGG-01
  switchport mode trunk
  switchport trunk allowed vlan 10,20,30,40,50,100,110-119,200

interface port-channel2
  description To AGG-02
  switchport mode trunk
  switchport trunk allowed vlan 10,20,30,40,50,100,110-119,200

! Server Connections - Web Tier
interface Ethernet1/10
  description Web Server 1
  switchport access vlan 10
  spanning-tree port type edge

interface Ethernet1/11
  description Web Server 2
  switchport access vlan 10
  spanning-tree port type edge

! Server Connections - Application Tier
interface Ethernet1/15
  description App Server 1 - vPC
  switchport access vlan 20
  channel-group 15 mode active

interface Ethernet1/16
  description App Server 2 - vPC
  switchport access vlan 20
  channel-group 16 mode active

interface port-channel15
  description App Server 1 vPC
  switchport access vlan 20
  vpc 15

interface port-channel16
  description App Server 2 vPC
  switchport access vlan 20
  vpc 16

! Server Connections - Database Tier
interface Ethernet1/20
  description Database Server 1
  switchport access vlan 30
  spanning-tree port type edge

! VMware ESXi Hosts
interface Ethernet1/25
  description ESXi Host 1 - vPC
  switchport mode trunk
  switchport trunk allowed vlan 10,20,30,110-119
  channel-group 25 mode active

interface Ethernet1/26
  description ESXi Host 2 - vPC
  switchport mode trunk
  switchport trunk allowed vlan 10,20,30,110-119
  channel-group 26 mode active

interface port-channel25
  description ESXi Host 1 vPC
  switchport mode trunk
  switchport trunk allowed vlan 10,20,30,110-119
  vpc 25

interface port-channel26
  description ESXi Host 2 vPC
  switchport mode trunk
  switchport trunk allowed vlan 10,20,30,110-119
  vpc 26

! Storage Network
interface Ethernet1/30
  description Storage Array 1
  switchport access vlan 200
  spanning-tree port type edge

! vPC Peer-Link
interface Ethernet1/47
  description vPC Peer-Link to ACCESS-02
  switchport mode trunk
  channel-group 100 mode active

interface Ethernet1/48
  description vPC Peer-Link to ACCESS-02
  switchport mode trunk
  channel-group 100 mode active

interface port-channel100
  description vPC Peer-Link
  switchport mode trunk
  vpc peer-link

! Management Interface
interface mgmt0
  ip address 192.168.100.5/24

! Spanning Tree
spanning-tree vlan 1-4094 priority 16384

! Logging and Monitoring
logging server 192.168.100.10
snmp-server community public ro
snmp-server host 192.168.100.10 traps version 2c public