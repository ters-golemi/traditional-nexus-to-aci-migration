! Nexus Aggregation Switch 1 Configuration
! Device: Nexus 9000 Series
! Role: Aggregation Layer with vPC to Access
! vPC Peer: agg-02

version 9.3(10)
hostname agg-01

! Management
username admin password 5 $5$CHANGE_ME role network-admin
ip domain-lookup

! vPC Configuration
feature vpc
vpc domain 200
  peer-switch
  peer-keepalive destination 192.168.100.4 source 192.168.100.3
  peer-gateway
  auto-recovery

! Features
feature lacp
feature interface-vlan

! VLANs
vlan 10
  name WEB_TIER
vlan 20
  name APP_TIER
vlan 30
  name DB_TIER
vlan 40
  name MGMT
vlan 50
  name DMZ
vlan 100
  name INFRASTRUCTURE
vlan 110-119
  name APPLICATION_VLANS
vlan 200
  name STORAGE

! Uplink to Core Layer
interface Ethernet1/1
  description To CORE-01 Eth1/1
  switchport mode trunk
  switchport trunk allowed vlan 10,20,30,40,50,100,110-119,200
  channel-group 1 mode active

interface Ethernet1/2
  description To CORE-01 Eth1/2
  switchport mode trunk
  switchport trunk allowed vlan 10,20,30,40,50,100,110-119,200
  channel-group 1 mode active

interface Ethernet1/3
  description To CORE-02 Eth1/3
  switchport mode trunk
  switchport trunk allowed vlan 10,20,30,40,50,100,110-119,200
  channel-group 2 mode active

interface Ethernet1/4
  description To CORE-02 Eth1/4
  switchport mode trunk
  switchport trunk allowed vlan 10,20,30,40,50,100,110-119,200
  channel-group 2 mode active

! Port-Channels to Core
interface port-channel1
  description To CORE-01
  switchport mode trunk
  switchport trunk allowed vlan 10,20,30,40,50,100,110-119,200

interface port-channel2
  description To CORE-02
  switchport mode trunk
  switchport trunk allowed vlan 10,20,30,40,50,100,110-119,200

! Downlinks to Access Layer
interface Ethernet1/10
  description To ACCESS-01 Eth1/1
  switchport mode trunk
  switchport trunk allowed vlan 10,20,30,40,50,100,110-119,200
  channel-group 10 mode active

interface Ethernet1/11
  description To ACCESS-01 Eth1/2
  switchport mode trunk
  switchport trunk allowed vlan 10,20,30,40,50,100,110-119,200
  channel-group 10 mode active

interface Ethernet1/12
  description To ACCESS-02 Eth1/1
  switchport mode trunk
  switchport trunk allowed vlan 10,20,30,40,50,100,110-119,200
  channel-group 11 mode active

interface Ethernet1/13
  description To ACCESS-02 Eth1/2
  switchport mode trunk
  switchport trunk allowed vlan 10,20,30,40,50,100,110-119,200
  channel-group 11 mode active

! Port-Channels to Access Layer
interface port-channel10
  description vPC to ACCESS-01
  switchport mode trunk
  switchport trunk allowed vlan 10,20,30,40,50,100,110-119,200
  vpc 10

interface port-channel11
  description vPC to ACCESS-02
  switchport mode trunk
  switchport trunk allowed vlan 10,20,30,40,50,100,110-119,200
  vpc 11

! vPC Peer-Link
interface Ethernet1/47
  description vPC Peer-Link to AGG-02
  switchport mode trunk
  channel-group 100 mode active

interface Ethernet1/48
  description vPC Peer-Link to AGG-02
  switchport mode trunk
  channel-group 100 mode active

interface port-channel100
  description vPC Peer-Link
  switchport mode trunk
  vpc peer-link

! Management Interface
interface mgmt0
  ip address 192.168.100.3/24

! Spanning Tree
spanning-tree vlan 1-4094 priority 8192

! Logging and Monitoring
logging server 192.168.100.10
snmp-server community public ro
snmp-server host 192.168.100.10 traps version 2c public